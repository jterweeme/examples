#!/usr/bin/python3

bitrates = [
    32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384,
     8, 16, 24, 32, 40, 48,  56,  64,  80,  96, 112, 128, 144, 160];

scf_base = [0x02000000, 0x01965FEA, 0x01428A30]
quant_lut_step1 = [[0] * 2 + [1] * 3 + [2] * 9, [0] * 6 + [1] * 3 + [2] * 5]
quant_lut_step2 = [[8, 8, 12], [27|64, 27|64, 27|64], [30|64, 27|64, 30|64]]

quant_lut_step3 = [
    [68] * 2 + [52] * 10,
    [67] * 3 + [66] * 8 + [49] * 12 + [32] * 7,
    [69] * 4 + [52] * 7 + [36]]

quant_lut_step4 = [
    [0,1,2,17],
    [0,1,2,3,4,5,6,17],
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 17],
    [0, 1, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17],
    [0, 1, 2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 17],
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
]

a = [0, 0, 0, 0, 0, 0, 0, -1,
-1, -1, -1, -2, -2, -3, -3, -4,
-4, -5, -6, -6, -7, -8, -9, -10,
-12, -13, -15, -16, -18, -20, -23, -25,
-28, -30, -34, -37, -40, -44, -48, -52,
 -57,  -62,  -67,  -72,  -78,  -84,  -90,  -96,
-103, -110, -116, -124, -131, -138, -146, -153,
-160, -168, -175, -182, -189, -195, -201, -207]



a += [213, 218, 222, 225, 227, 228, 228, 227, 224, 221, 215, 208, 200, 189,
177, 163, 146, 127, 106, 83, 57, 29, -1, -35, -71, -110, -152, -196, -243,
-293, -346, -400, -458, -518, -580, -644, -710, -778, -847, -918, -990, -1063,
-1136, -1209, -1282, -1355, -1427, -1497, -1566, -1633, -1697, -1758, -1816,
-1869, -1918, -1961, -2000, -2031, -2056, -2074, -2084, -2086, -2079, -2062]

a += [2037, 2000, 1952, 1893, 1822, 1739, 1644, 1535, 1414, 1280, 1131, 970,
794, 605, 402, 185, -44, -287, -544, -813, -1094, -1387, -1691, -2005, -2329,
-2662, -3003, -3350, -3704, -4062, -4424, -4787, -5152, -5516, -5878, -6236,
-6588, -6934, -7270, -7596, -7909, -8208, -8490, -8754, -8997, -9218, -9415,
-9584, -9726, -9837, -9915, -9958, -9965, -9934, -9862, -9749, -9591, -9388,
-9138, -8839, -8491, -8091, -7639, -7133]

a += [6574, 5959, 5288, 4561, 3776, 2935,
2037, 1082, 70, -997, -2121, -3299, -4532, -5817, -7153, -8539, -9974, -11454,
-12979, -14547, -16154, -17798, -19477, -21188, -22928, -24693, -26481, -28288,
-30111, -31946, -33790, -35639, -37488, -39335, -41175, -43005, -44820, -46616,
-48389, -50136, -51852, -53533, -55177, -56777, -58332, -59837, -61288, -62683,
-64018, -65289, -66493, -67628, -68691, -69678, -70589, -71419, -72168, -72834,
-73414, -73907, -74312, -74629, -74855, -74991]

a += [75038, 74992, 74856, 74630,
74313, 73908, 73415, 72835, 72169, 71420, 70590, 69679, 68692, 67629, 66494, 
65290, 64019, 62684, 61289, 59838, 58333, 56778, 55178, 53534, 51853, 50137,
48390, 46617, 44821, 43006, 41176, 39336, 37489, 35640, 33791, 31947, 30112,
28289, 26482, 24694, 22929, 21189, 19478, 17799, 16155, 14548, 12980, 11455,
9975, 8540, 7154, 5818, 4533, 3300, 2122, 998, -69, -1081, -2036, -2934,
-3775, -4560, -5287, -5958]

a += [6574, 7134, 7640, 8092, 8492, 8840, 9139, 9389, 9592, 9750, 9863, 9935,
9966, 9959, 9916, 9838, 9727, 9585, 9416, 9219, 8998, 8755, 8491, 8209, 7910,
7597, 7271, 6935, 6589, 6237, 5879, 5517, 5153, 4788, 4425, 4063, 3705, 3351,
3004, 2663, 2330, 2006, 1692, 1388, 1095, 814, 545, 288, 45, -184, -401, -604,
-793, -969, -1130, -1279, -1413, -1534, -1643, -1738, -1821, -1892, -1951, -1999]

a += [2037, 2063, 2080, 2087, 2085, 2075, 2057, 2032, 2001, 1962,
1919, 1870, 1817, 1759, 1698, 1634, 1567, 1498, 1428, 1356, 1283, 1210, 1137,
1064, 991, 919, 848, 779, 711, 645, 581, 519, 459, 401, 347, 294, 244, 197,
153, 111, 72, 36, 2, -28, -56, -82, -105, -126, -145, -162, -176, -188, -199,
-207, -214, -220, -223, -226, -227, -227, -226, -224, -221, -217]

a += [213, 208, 202,
196, 190, 183, 176, 169, 161, 154, 147, 139, 132, 125, 117, 111, 104, 97, 91,
85, 79, 73, 68, 63, 58, 53, 49, 45, 41, 38, 35, 31, 29, 26, 24, 21, 19, 17, 16,
14, 13, 11, 10, 9, 8, 7, 7, 6, 5, 5, 4, 4, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1]

def integrate(lst):
    ret = [lst[0]]
    for i in range(1, len(lst)):
        ret += [ret[-1] + lst[i]]
    return ret

d = [0,0,0,0,0,0,0,-1,0,0,0,-1,0,-1, 0,-1,0,-1,-1,0, -1,-1,-1,-1,-2,-1,-2,-1,-2,-2,-3,-2,
-3,-2,-4,-3,-3,-4,-4,-4,-5,-5,-5,-5,-6,-6,-6,-6,-7,-7,-6,-8,-7,-7,-8,-7,-7,-8,-7,-7,-7,-6,-6,-6]

"""
e = [213, 5, 4, 3, 2, 1, 0, -1, -3, -3, -4, -7, -8, -11,
-12, -14, 
"""

b = integrate(d)

b += [213, 218, 222, 225, 227, 228, 228, 227, 224, 221, 215, 208, 200, 189,
177, 163, 146, 127, 106, 83, 57, 29, -1, -35, -71, -110, -152, -196, -243,
-293, -346, -400, -458, -518, -580, -644, -710, -778, -847, -918, -990, -1063,
-1136, -1209, -1282, -1355, -1427, -1497, -1566, -1633, -1697, -1758, -1816,
-1869, -1918, -1961, -2000, -2031, -2056, -2074, -2084, -2086, -2079, -2062]

b += [2037, 2000, 1952, 1893, 1822, 1739, 1644, 1535, 1414, 1280, 1131, 970,
794, 605, 402, 185, -44, -287, -544, -813, -1094, -1387, -1691, -2005, -2329,
-2662, -3003, -3350, -3704, -4062, -4424, -4787, -5152, -5516, -5878, -6236,
-6588, -6934, -7270, -7596, -7909, -8208, -8490, -8754, -8997, -9218, -9415,
-9584, -9726, -9837, -9915, -9958, -9965, -9934, -9862, -9749, -9591, -9388,
-9138, -8839, -8491, -8091, -7639, -7133, 6574, 5959, 5288, 4561, 3776, 2935,
2037, 1082, 70, -997, -2121, -3299, -4532, -5817, -7153, -8539, -9974, -11454,
-12979, -14547, -16154, -17798, -19477, -21188, -22928, -24693, -26481, -28288,
-30111, -31946, -33790, -35639, -37488, -39335, -41175, -43005, -44820, -46616,
-48389, -50136, -51852, -53533, -55177, -56777, -58332, -59837, -61288, -62683,
-64018, -65289, -66493, -67628, -68691, -69678, -70589, -71419, -72168, -72834,
-73414, -73907, -74312, -74629, -74855, -74991]

b += [75038] + [(b[255 - x] -1) * -1 for x in range(63)]
b += [b[192]] + [(b[191 - x] -1) * -1 for x in range(63)]
b += [b[128]] + [(b[127 - x] -1) * -1 for x in range(63)]
b += [b[64]] + [(b[63 - x] -1) * -1 for x in range(63)]

assert(a == b)

import math
import matplotlib.pyplot as plt

plt.plot(a)
plt.show()


class Buffer:
    pass



